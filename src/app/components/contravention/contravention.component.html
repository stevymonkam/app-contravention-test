<div class="contravention-container">
  <!-- Sidebar Navigation -->
  <div class="sidebar">
    <nav class="nav-menu">
      <a href="#" class="nav-item">
        <i class="material-icons">home</i>
        Home
      </a>
      <a href="#" class="nav-item active">
        <i class="material-icons">add</i>
        Nuova
      </a>
      <a href="#" class="nav-item">
        <i class="material-icons">print</i>
        Stampa
      </a>
      <a href="#" class="nav-item">
        <i class="material-icons">mail</i>
        Mail
        <i class="material-icons arrow">keyboard_arrow_right</i>
      </a>
      <a href="#" class="nav-item">
        <i class="material-icons">help</i>
        Aiuto
      </a>
    </nav>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <div class="form-container">
      <h2 class="form-title">{{ isEditMode ? 'Modifica Contravention' : 'Nuova Contravention' }}</h2>
      
      <form [formGroup]="contraventionForm" (ngSubmit)="onSubmit()" class="contravention-form">
        
        <!-- Row 1 - Identification -->
        <div class="form-row">
          <div class="form-field">
            <label for="numVerbale" class="required">Numero Verbale *</label>
            <input 
              id="numVerbale"
              type="text" 
              formControlName="numVerbale"
              [class.error]="f['numVerbale'].invalid && f['numVerbale'].touched"
              [readonly]="isEditMode"
              placeholder="Numero verbale">
          </div>

          <div class="form-field">
            <label for="targa">Targa</label>
            <input 
              id="targa"
              type="text" 
              formControlName="targa"
              placeholder="Inserisci targa">
          </div>

          <div class="form-field">
            <label for="guidatore">Guidatore</label>
            <input 
              id="guidatore"
              type="text" 
              formControlName="guidatore"
              placeholder="Nome guidatore">
          </div>

          <div class="form-field">
            <label for="emailGuidatore">Email Guidatore</label>
            <input 
              id="emailGuidatore"
              type="email" 
              formControlName="emailGuidatore"
              placeholder="Email guidatore">
          </div>

          <div class="form-field">
            <label for="societaIntestataria">Società Intestataria</label>
            <input 
              id="societaIntestataria"
              type="text" 
              formControlName="societaIntestataria"
              placeholder="Società">
          </div>
        </div>

        <!-- Row 2 - Date e Scadenze -->
        <div class="form-row">
          <div class="form-field">
            <label for="dataVerbale">Data Verbale</label>
            <input 
              id="dataVerbale"
              type="date" 
              formControlName="dataVerbale">
          </div>

          <div class="form-field">
            <label for="dataNotifica">Data Notifica</label>
            <input 
              id="dataNotifica"
              type="date" 
              formControlName="dataNotifica">
          </div>

          <div class="form-field">
            <label for="ggScadenza">Giorni Scadenza</label>
            <input 
              id="ggScadenza"
              type="number" 
              formControlName="ggScadenza"
              placeholder="Giorni">
          </div>

          <div class="form-field">
            <label for="comuneVerbale">Comune del verbale</label>
            <input 
              id="comuneVerbale"
              type="text" 
              formControlName="comuneVerbale"
              placeholder="Comune">
          </div>

          <div class="form-field">
            <label for="sedeNotifica">Sede Notifica</label>
            <input 
              id="sedeNotifica"
              type="text" 
              formControlName="sedeNotifica"
              placeholder="Sede notifica">
          </div>

          <div class="form-field">
            <label for="giorniScadenza" class="required">Giorni alla scadenza *</label>
            <input 
              id="giorniScadenza"
              type="text" 
              formControlName="sedeNotifica"
              placeholder="Sede">
          </div>
        </div>

        <!-- Row 3 - Importi e Pagamenti -->
        <div class="form-row">
          <div class="form-field">
            <label for="importo">Importo</label>
            <input 
              id="importo"
              type="number" 
              formControlName="importo"
              placeholder="€">
          </div>

          <div class="form-field">
            <label for="importoIntegrato">Importo Integrato</label>
            <input 
              id="importoIntegrato"
              type="number" 
              formControlName="importoIntegrato"
              placeholder="€">
          </div>

          <div class="form-field">
            <label for="numVerbaleCorrelato">Verbale Correlato</label>
            <input 
              id="numVerbaleCorrelato"
              type="text" 
              formControlName="numVerbaleCorrelato"
              placeholder="Numero verbale correlato">
          </div>

          <div class="form-field">
            <label for="dataSpediziFinanz">Data spediz. al finanziario</label>
            <input 
              id="dataSpediziFinanz"
              type="date" 
              formControlName="dataSpediziFinanz">
          </div>

          <div class="form-field">
            <label for="dataPagamentoVerb">Data pagamento verbale</label>
            <input 
              id="dataPagamentoVerb"
              type="date" 
              formControlName="dataPagamentoVerb">
          </div>
        </div>

        <!-- Row 4 - Ricorso e Decurtazione -->
        <div class="form-row">
          <div class="form-field radio-group">
            <label>Pagato da Azienda/Dipendente</label>
            <div class="radio-buttons">
              <label class="radio-label">
                <input type="radio" formControlName="pagatoAziendaDipendente" [value]="true">
                <span>Azienda</span>
              </label>
              <label class="radio-label">
                <input type="radio" formControlName="pagatoAziendaDipendente" [value]="false">
                <span>Dipendente</span>
              </label>
            </div>
          </div>

          <div class="form-field radio-group">
            <label>Ricorso</label>
            <div class="radio-buttons">
              <label class="radio-label">
                <input type="radio" formControlName="ricorso" [value]="true">
                <span>Si</span>
              </label>
              <label class="radio-label">
                <input type="radio" formControlName="ricorso" [value]="false">
                <span>No</span>
              </label>
            </div>
          </div>

          <div class="form-field">
            <label for="ggRicorso">Giorni Ricorso</label>
            <input 
              id="ggRicorso"
              type="number" 
              formControlName="ggRicorso"
              placeholder="Giorni">
          </div>

          <div class="form-field">
            <label for="dataInvioRicorso">Data Invio Ricorso</label>
            <input 
              id="dataInvioRicorso"
              type="date" 
              formControlName="dataInvioRicorso">
          </div>

          <div class="form-field radio-group">
            <label>Decurtazione punti</label>
            <div class="radio-buttons">
              <label class="radio-label">
                <input type="radio" formControlName="decurtaPunti" [value]="true">
                <span>Si</span>
              </label>
              <label class="radio-label">
                <input type="radio" formControlName="decurtaPunti" [value]="false">
                <span>No</span>
              </label>
            </div>
          </div>
        </div>

        <!-- Row 5 - Nuovi Campi -->
        <div class="form-row">
          <div class="form-field">
            <label for="dataInvioDecurtazione">Data Invio Decurtazione</label>
            <input 
              id="dataInvioDecurtazione"
              type="date" 
              formControlName="dataInvioDecurtazione">
          </div>

          <div class="form-field">
            <label for="mmyyyyTrattenutaCedolino">Trattenuta Cedolino (MM/YYYY)</label>
            <input 
              id="mmyyyyTrattenutaCedolino"
              type="text" 
              formControlName="mmyyyyTrattenutaCedolino"
              placeholder="MM/YYYY">
          </div>

          <div class="form-field">
            <label for="mmyyyyTrattenutaDiffMultaCedolino">Trattenuta Diff. Cedolino (MM/YYYY)</label>
            <input 
              id="mmyyyyTrattenutaDiffMultaCedolino"
              type="text" 
              formControlName="mmyyyyTrattenutaDiffMultaCedolino"
              placeholder="MM/YYYY">
          </div>

          <div class="form-field">
            <label for="idStatoPratica">ID Stato Pratica</label>
            <input 
              id="idStatoPratica"
              type="number" 
              formControlName="idStatoPratica"
              placeholder="Stato">
          </div>

          <div class="form-field">
            <label for="exSocietaIntestataria">Ex Società Intestataria</label>
            <input 
              id="exSocietaIntestataria"
              type="text" 
              formControlName="exSocietaIntestataria"
              placeholder="Ex società">
          </div>
        </div>

        <!-- Row 6 - Note -->
        <div class="form-row">
          <div class="form-field full-width">
            <label for="note">Note</label>
            <textarea 
              id="note"
              formControlName="note"
              rows="3"
              placeholder="Inserisci note..."></textarea>
          </div>
        </div>

        <!-- File Upload Section -->
        <div class="file-upload-section">
          <h3>Allegati / Files</h3>
          
          <div class="upload-form" [formGroup]="fileUploadForm">
            <div class="upload-row">
              <div class="form-field">
                <label for="elemento">Elemento</label>
                <input 
                  id="elemento"
                  type="text" 
                  formControlName="elemento"
                  placeholder="Nome elemento">
              </div>

              <div class="form-field">
                <label for="tipoFile">Tipo</label>
                <input 
                  id="tipoFile"
                  type="text" 
                  formControlName="tipo"
                  placeholder="Tipo file">
              </div>

              <div class="form-field">
                <label for="dataFile">Data</label>
                <input 
                  id="dataFile"
                  type="date" 
                  formControlName="data">
              </div>

              <div class="form-field">
                <label for="testo1File">Testo 1</label>
                <input 
                  id="testo1File"
                  type="text" 
                  formControlName="testo1"
                  placeholder="Testo 1">
              </div>

              <div class="form-field">
                <label for="testo2File">Testo 2</label>
                <input 
                  id="testo2File"
                  type="text" 
                  formControlName="testo2"
                  placeholder="Testo 2">
              </div>

              <div class="form-field">
                <label for="noteFile">Note</label>
                <input 
                  id="noteFile"
                  type="text" 
                  formControlName="note"
                  placeholder="Note per il file">
              </div>

              <div class="file-input-container">
                <input 
                  type="file" 
                  id="fileInput" 
                  multiple
                  (change)="onFileSelected($event)"
                  style="display: none;">
                <button 
                  type="button" 
                  class="btn-choose-file"
                  (click)="triggerFileInput()">
                  Scegli file
                </button>
                <span class="file-info">
                  {{ selectedFiles.length > 0 ? selectedFiles.length + ' file selezionati' : 'Nessun file selezionato' }}
                </span>
                <button 
                  type="button" 
                  class="btn-upload"
                  (click)="uploadFiles()"
                  [disabled]="selectedFiles.length === 0">
                  <i class="material-icons">upload</i>
                  Carica
                </button>
              </div>
            </div>
          </div>

          <!-- Files Table -->
          <div class="files-table" *ngIf="uploadedFiles.length > 0">
            <table>
              <thead>
                <tr>
                  <th>Elemento</th>
                  <th>Tipo</th>
                  <th>Data</th>
                  <th>Testo1</th>
                  <th>Testo2</th>
                  <th>Note</th>
                  <th>Azioni</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let file of uploadedFiles; let i = index">
                  <td>{{ file.elemento || '-' }}</td>
                  <td>{{ file.tipo || '-' }}</td>
                  <td>{{ file.data || '-' }}</td>
                  <td>{{ file.testo1 || '-' }}</td>
                  <td>{{ file.testo2 || '-' }}</td>
                  <td>{{ file.note || '-' }}</td>
                  <td>
                    <button 
                      type="button" 
                      class="btn-remove"
                      (click)="removeFile(i)">
                      <i class="material-icons">delete</i>
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
          <button 
            type="button" 
            class="btn-cancel"
            (click)="onCancel()">
            Cancella
          </button>
          <button 
            *ngIf="isEditMode"
            type="button" 
            class="btn-back"
            (click)="backToList()">
            Torna alla lista
          </button>
          <button 
            type="button" 
            class="btn-print"
            (click)="onPrint()">
            Stampa
          </button>
          <button 
            type="submit" 
            class="btn-submit"
            [disabled]="isLoading">
            <span *ngIf="isLoading">{{ isEditMode ? 'Aggiornamento...' : 'Invio in corso...' }}</span>
            <span *ngIf="!isLoading">{{ isEditMode ? 'Modifica' : 'Invia' }}</span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>